<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Simon Goring" />

<meta name="date" content="2017-10-13" />

<title>Throughput Database Case Studies</title>

<script src="case_study_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="case_study_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="case_study_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="case_study_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="case_study_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="case_study_files/navigation-1.1/tabsets.js"></script>
<link href="case_study_files/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="case_study_files/highlightjs-1.1/highlight.js"></script>
<script src="case_study_files/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="case_study_files/d3-4.5.0/d3.min.js"></script>
<script src="case_study_files/forceNetwork-binding-0.4/forceNetwork.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Throughput Database Case Studies</h1>
<h4 class="author"><em>Simon Goring</em></h4>
<h4 class="date"><em>October 13, 2017</em></h4>

</div>


<div id="overview" class="section level2">
<h2>Overview</h2>
<p>Throughput is designed to facilitate the transmission of schientific cultural knowledge around data resources to assist interdisciplinary research. We want to move anecdotal information about records from the lab to the cloud. The goal of this document is to highlight several key case studies that inform the development of the data resource, by caturing key use patterns.</p>
</div>
<div id="technology-background" class="section level2">
<h2>Technology Background</h2>
<p>At present the Throughput DB stack is at the proof of concept stage, but much of the technological infrastructure has been chosen with the data model and architecture at the forefront of the design decisions.</p>
<div id="api-first-development" class="section level3">
<h3>API First Development</h3>
<p>The Throughoput Database is intended as a back-end service to link data resources. As such investment in UI/UX design is less important at this stage than investment in a well developed API. The API will have <code>POST</code> and <code>GET</code> methods, roughly mapping to:</p>
<pre><code>GET  resource
     body
     target
POST annotation</code></pre>
<p>The <code>GET</code> methods will return data objects representing the resources associated with the annotation engine (the data repositories), the annotation bodies, supporting, for example, keyword searches <em>&amp;cetera</em>, and target related searches, generally querying DOIs or other UIDs.</p>
</div>
<div id="neo4j" class="section level3">
<h3>neo4j</h3>
<p>The linked nature of the data suggests that a graph database would provide the greatest support for the data model. Here we envision several node and link types, including <code>person</code>, <code>resource</code>, <code>thing</code> data types (using the W3C Annotation and <a href="">schema.org</a> data models). Targets and Bodies would be identified through graph relationships, for example:</p>
<p><img src=images/simplest_annotation.svg></p>
<p>By ensuring that bodies and targets have a common node type we can then ensure that annotation bodies themselves can be annotated. <code>neo4j</code> has a number of packages to support Java, JavaScript, R and other programming languages. This means that development of the API itself can be platform agnostic, thus, replication of the database and development of a new interface should provide the ability to fork the project easily.</p>
</div>
<div id="docker" class="section level3">
<h3>Docker</h3>
<p>Docker containers act to isolate a set of system components from the underlying architecture. Given this setup it is possible to run a system with the same custom components on a local system, a remote server, or on a collaborators system. We use a container configured for <code>neo4j</code> using the <code>neo4j:3.0</code> container, and run using a <code>yaml</code> configuration file that points the neo4j browser to port 17474. This way it doesnâ€™t interfere with any local instances of neo4j.</p>
</div>
<div id="w3c-standards" class="section level3">
<h3>W3C Standards</h3>
<p>In general this model contains only four key elements. An annotation, which is effectively an empty node used to link elements, a body and target are both the same node type, this allows an annotation body to be a target in and of itself.</p>
</div>
</div>
<div id="case-studies" class="section level2">
<h2>Case Studies</h2>
<pre class="r"><code>library(RNeo4j)
library(networkD3)

pass &lt;- readr::read_lines(&#39;../auth.log&#39;)

con &lt;- RNeo4j::startGraph(&quot;http://localhost:17474/db/data/&quot;, username = pass[1], pass[2])

source(&#39;R/link_record.R&#39;)</code></pre>
<div id="individual-focused-annotation" class="section level3">
<h3>Individual Focused Annotation</h3>
<div id="an-individual-annotates-one-or-several-records." class="section level4">
<h4>An Individual Annotates One or Several Records.</h4>
<p>In this instance, a researcher working on a project has discovered an issue with a single, or several datasets within a resource. This issue may not be an error <em>per se</em> or a deficiency with the dataset, but may simply be an artifact of methodological or disciplinary-related procedures. Thus, the annotation helps indicate that special steps may be required to process the data, or may indicate reasons why the data may be an outlier in analysis.</p>
<div id="duplicate-analytic-layers-in-neotoma" class="section level5">
<h5>Duplicate analytic layers in Neotoma</h5>
<p>In sedimentary pollen analysis it may be the case that a researcher counts multiple slides at a single depth. In many cases these counts are summed and reported as a single value, but it may be the case that they are reported independently. For a researcher unfamiliar with pollen analysis this may result in confusion, particularly when counts differ. Thus, an individual encountering this issue for the first time may wish to annotate a single record.</p>
<p>In this case, the annotator, Simon Goring (orcid: <a href="http://orcid.org/0000-0002-2700-4605">0000-0002-2700-4605</a>) creates a text annotation that targets the dataset object from Neotoma. Given this structure we generate a graph to indicate this relationship. Once generated as part of the larger graph and API system, the annotation can be served as part of a query relating to a number of factors.</p>
<pre class="r"><code>cypher(con, &#39;MATCH (n) OPTIONAL MATCH (n)-[r]-() DELETE n,r;&#39;)

creator &lt;- list(URL = &#39;0000-0002-2700-4605&#39;,
               PropertyID = &#39;orcid&#39;,
               firstName = &#39;Simon&#39;,
               lastName = &#39;Goring&#39;)

body &lt;- list(type = &quot;TextualBody&quot;,
             value = &quot;Two samples counted at the same depth (x=94cm) with the same ages.  It seems like these samples are two separate counts at the same depth and may be summed during analysis.&quot;)

target &lt;- list(type = &quot;URL&quot;,
               value = &quot;http://api.neotomadb.org/v1/data/datasets/13047&quot;)

source &lt;- list(type = &quot;DOI&quot;,
               value = &quot;10.17616/R3PD38&quot;)

link_record(con = con, 
            creator = creator, 
            body = body, 
            target = target,
            source = source)</code></pre>
<div align="center">
<div id="htmlwidget-e2fdc9b1675fdd7642da" style="width:150px;height:150px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e2fdc9b1675fdd7642da">{"x":{"links":{"source":[0,1,2,3,3,3,4,0],"target":[3,3,3,1,2,0,0,4],"value":["hasTarget","created","hasBody","created","hasBody","hasTarget","hasRes","hasRes"],"colour":["#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["object","creator","object","annotation","object"],"group":["object","creator","object","annotation","object"],"nodesize":["24","24","24","24","24"]},"options":{"NodeID":"type","Group":"type","colourScale":"d3.scaleOrdinal(d3.schemeCategory10);","fontSize":7,"fontFamily":"serif","clickTextSize":17.5,"linkDistance":50,"linkWidth":"function(d) { return Math.sqrt(d.value); }","charge":-30,"opacity":1,"zoom":false,"legend":false,"arrows":false,"nodesize":true,"radiusCalculation":" Math.sqrt(d.nodesize)+6","bounded":false,"opacityNoHover":0,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="an-individual-links-datasets-to-a-publication" class="section level5">
<h5>An individual links datasets to a publication</h5>
<p>In many cases, datasets may be used in multiple publications. Some data resources can track this resuse, but many rely on self-reporting, and this oftenresults in incomplete data. It may also be the case that tracking data reuse is beyond the scope of the data resource. Thus, linking resources to publications through anotation provides a service for the data resources, but also for subsequent researchers. Here a data user annotates datasets used in one of their publications:</p>
<pre class="r"><code>cypher(con, &#39;MATCH (n) OPTIONAL MATCH (n)-[r]-() DELETE n,r;&#39;)

if(&#39;all_ds.rds&#39; %in% list.files(&#39;data&#39;)) {
  all_neot &lt;- readRDS(&#39;data/all_ds.rds&#39;)
} else {
  all_neot &lt;- neotoma::get_dataset()
  saveRDS(all_neot, &#39;data/all_ds.rds&#39;)
}

all_matched &lt;- readr::read_csv(&#39;../../stepps-baconizing/data/input/blois_files/2011-01-06-all.matched.lp.sites.csv&#39;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   id = col_integer(),
##   Longitude = col_double(),
##   Latitude = col_double(),
##   Altitude = col_integer(),
##   Chronology = col_integer(),
##   AgeBoundYo = col_integer(),
##   AgeBoundOl = col_integer(),
##   lon_alb_km = col_double(),
##   lat_alb_km = col_double(),
##   alt_km = col_double(),
##   picea_decline_idw_2d_age_mean = col_integer(),
##   picea_decline_idw_2d_age_older = col_integer(),
##   picea_decline_idw_2d_age_younger = col_integer(),
##   picea_decline_depth = col_double(),
##   alnus_decline_idw_2d_age_mean = col_integer(),
##   alnus_decline_idw_2d_age_older = col_integer(),
##   alnus_decline_idw_2d_age_younger = col_integer(),
##   alnus_decline_depth = col_double(),
##   quercus_rise_idw_2d_age_mean = col_integer(),
##   quercus_rise_idw_2d_age_older = col_integer()
##   # ... with 2 more columns
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>ds_names &lt;- sapply(all_neot, function(x) x$dataset.meta$collection.handle)

blois_sets &lt;- sapply(match(all_matched$Handle, ds_names),
                     function(x) {
                       if (!is.na(x)) {
                         return(list(type = &#39;Dataset&#39;,
                                     value = paste0(&#39;http://api.neotomadb.org/v1/data/datasets/&#39;, 
                                                     all_neot[[x]]$dataset.meta$dataset.id)))
                       } else {
                         return(NA)
                       }
                     })

names(blois_sets) &lt;- rep(&#39;target&#39;, length(blois_sets))

for (i in length(blois_sets):1) {
  if (any(is.na(blois_sets[[i]]))) {
    blois_sets[[i]] &lt;- NULL
  }
}

creator &lt;- list(URL = &#39;0000-0003-4048-177X&#39;,
                PropertyID = &#39;orcid&#39;,
                lastName = &#39;Blois&#39;,
                firstName = &#39;Jessica&#39;)

target &lt;- blois_sets

# Multiple body elements:
body &lt;- list(body = list(type=&#39;TextualBody&#39;,
                         value =&#39;Age models rebuilt with new biostratigraphic markers.&#39;),
             body = list(type = &#39;ScholarlyArticle&#39;,
                         value=&#39;http://dx.doi.org/10.1016/j.quascirev.2011.04.017&#39;))

source &lt;- list(type = &quot;DOI&quot;,
               value = &quot;10.17616/R3PD38&quot;)

link_record(con = con, 
            creator = creator, 
            body = body, 
            target = target,
            source = source)</code></pre>
<div align="center">
<div id="htmlwidget-c9f0e523537fb31862d4" style="width:300px;height:300px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-c9f0e523537fb31862d4">{"x":{"links":{"source":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,161,161,162,161,4,5,6,15,8,9,10,3,12,13,14,24,16,17,18,11,22,19,32,21,26,23,20,25,30,27,134,29,34,31,28,33,36,49,38,35,40,37,42,39,44,58,46,43,48,45,50,47,66,51,52,53,54,55,56,57,7,59,60,61,62,63,64,65,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,84,86,83,88,85,90,87,92,89,94,91,96,93,98,95,41,97,67,99,100,101,105,102,107,104,109,106,153,108,117,114,127,116,121,118,115,120,125,122,111,124,129,126,123,128,131,132,133,142,135,136,137,130,139,140,141,119,143,144,145,138,156,146,147,148,149,150,151,152,154,155,158,103,160,157,112,159,110,113,162,161,161,162,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,161,162,162,161,161,162,162,161,161,162,162,161,161,162,161,162,161,162,162,161,161,162,162,161,161,162,162,161,161,162,161,162,162,161,161,162,162,161,162,161,162,161,161,162,162,161,161,162,162,161,161,162,162,161,162,161,162,161,161,162,162,161,162,161,161,162,161,162,161,162,162,161,161,162,161,162,161,162,161,162,161,162,161,162,161,162,162,161,161,162,161,162,161,162,162,161,161,162,162,161,161,162,161,162,161,162,162,161,161,162,162,161,161,162,162,161,161,162,161,162,161,162,162,161,161,162,162,161,162,161,162,161,162,161,161,162,162,161,162,161,162,161,162,161,162,161,162,161,162,161,161,162,162,161,162,161,162,161,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,162,161,161,162,161,162,161,162,161,162,161,162,161,162,161,162,162,161,162,161,161,162,162,161,161,162,162,161,161,162,162,161,162,161,162,161,161,162,162,161,161,162,162,161,161,162,162,161,161,162,161,162,162,161,161,162,162,161,161,162,162,161,161,162,162,161,161,162,162,161,161,162,162,161,161,162,162,161,161,162,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,162,161,161,162,161,162,161,162,161,162],"target":[161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,0,1,2,154,154,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,155,155,156,156,146,146,147,147,148,148,149,149,150,150,151,151,152,152,153,153,108,108,109,109,106,106,107,107,104,104,105,105,102,102,103,103,158,158,157,157,160,160,159,159,112,112,113,113,110,110,111,111,124,124,125,125,122,122,123,123,128,128,129,129,126,126,127,127,116,116,117,117,114,114,115,115,120,120,121,121,118,118,119,119,141,141,140,140,139,139,138,138,145,145,144,144,143,143,142,142,133,133,132,132,131,131,130,130,137,137,136,136,135,135,134,134,29,29,30,30,27,27,28,28,33,33,34,34,31,31,32,32,21,21,22,22,19,19,20,20,25,25,26,26,23,23,24,24,14,14,13,13,12,12,11,11,18,18,17,17,16,16,15,15,6,6,5,5,4,4,3,3,10,10,9,9,8,8,7,7,59,59,60,60,61,61,62,62,63,63,64,64,65,65,66,66,51,51,52,52,53,53,54,54,55,55,56,56,57,57,58,58,44,44,43,43,46,46,45,45,48,48,47,47,50,50,49,49,36,36,35,35,38,38,37,37,40,40,39,39,42,42,41,41,97,97,98,98,95,95,96,96,93,93,94,94,91,91,92,92,89,89,90,90,87,87,88,88,85,85,86,86,83,83,84,84,82,82,81,81,80,80,79,79,78,78,77,77,76,76,75,75,74,74,73,73,72,72,71,71,70,70,69,69,68,68,67,67,99,99,100,100,101,101],"value":["created","hasBody","hasBody","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","hasTarget","created","hasBody","hasBody","hasRes","hasTarget","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasTarget","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasTarget","hasRes"],"colour":["#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["creator","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","annotation","object"],"group":["creator","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","annotation","object"],"nodesize":["12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12","12"]},"options":{"NodeID":"type","Group":"type","colourScale":"d3.scaleOrdinal(d3.schemeCategory10);","fontSize":7,"fontFamily":"serif","clickTextSize":17.5,"linkDistance":50,"linkWidth":"function(d) { return Math.sqrt(d.value); }","charge":-30,"opacity":1,"zoom":false,"legend":false,"arrows":false,"nodesize":true,"radiusCalculation":" Math.sqrt(d.nodesize)+6","bounded":false,"opacityNoHover":0,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
<div id="a-resource-annotates-records" class="section level3">
<h3>A resource annotates records</h3>
<p>There may be occasions where a script, written by an individual, but associated with a resource, may annotate records. For example, Neotoma and the Paleobiology Database share certain records, but this may not be entirely apparent, or one database may use a script or workflow to improve geolocation of data resources from historical papers. In this case it may be useful to annotate records to either identify links across resources, or to identify any post-processing that has occurred within the resource.</p>
<div id="data-resource-linking" class="section level4">
<h4>Data resource linking</h4>
<p>Here we have two records, one, a set of pollen records from Neotoma, the other a set of records within the Arctic Data Center. In this first code block, a researcher (Jack Williams) notes that a set of records added to the Arctic Data Center are linked to a publication in PNAS.</p>
<pre class="r"><code>cypher(con, &#39;MATCH (n) OPTIONAL MATCH (n)-[r]-() DELETE n,r;&#39;)

creator &lt;- list(URL = &#39;0000-0001-6046-9634&#39;,
               PropertyID = &#39;orcid&#39;,
               firstName = &#39;John&#39;,
               lastName = &#39;Williams&#39;)

body &lt;- list(body = list(type = &#39;AnnotationText&#39;,
                         value = &#39;All resources linked by publication and project as part of the St Paul\&#39;s project.&#39;),
             body = list(type = &#39;ScholarlyArticle&#39;,
                         value = &#39;10.1073/pnas.1604903113&#39;))

target &lt;- list(target = list(type = &#39;DOI&#39;,
                             value = &#39;10.18739/A27N5S&#39;),
               target = list(type = &#39;DOI&#39;,
                             value = &#39;10.18739/A2X68N&#39;),
               target = list(type = &#39;DOI&#39;,
                             value = &#39;10.18739/A2MH0X&#39;))

source &lt;- list(type = &#39;DOI&#39;,
               value = &#39;10.17616/R37P98&#39;)

link_record(con = con, 
            creator = creator, 
            body = body, 
            target = target,
            source = source)</code></pre>
<p>These records are also in Neotoma, and, as such, these records can be linked in any number of ways. Here, Simon Goring links the resources by noting that one of the Arctic Data records represents the same physical object as the pollen object within Neotoma:</p>
<pre class="r"><code>creator &lt;- list(URL = &#39;0000-0002-2700-4605&#39;,
               PropertyID = &#39;orcid&#39;,
               firstName = &#39;Simon&#39;,
               lastName = &#39;Goring&#39;)

body &lt;- list(body = list(type = &#39;AnnotationText&#39;,
                         value = &#39;The Neotoma record has a set of geophysical data recorded in the Arctic Data Center.  It\&#39;s all part of the same analysis.&#39;),
             body = list(type = &#39;DOI&#39;,
                         value = &#39;10.18739/A27N5S&#39;))

target &lt;- list(target = list(type = &#39;URL&#39;,
                             value = &#39;http://apps.neotomadb.org/explorer/?datasetid=20188&#39;))

source &lt;- list(type = &quot;DOI&quot;,
               value = &quot;10.17616/R3PD38&quot;)

link_record(con = con, 
            creator = creator, 
            body = body, 
            target = target,
            source = source)</code></pre>
<p>This then produces the following graph:</p>
<div align="center">
<div id="htmlwidget-3ada7ec6166c2218355a" style="width:300px;height:300px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-3ada7ec6166c2218355a">{"x":{"links":{"source":[0,1,2,3,4,5,6,6,6,7,6,8,2,3,4,6,8,6,8,9,10,11,2,7,7,7,12,11],"target":[6,6,6,6,6,6,5,0,1,2,2,2,8,8,8,3,3,4,4,7,7,7,7,10,9,11,11,12],"value":["hasBody","hasBody","hasTarget","hasTarget","hasTarget","created","created","hasBody","hasBody","hasBody","hasTarget","hasRes","hasRes","hasRes","hasRes","hasTarget","hasRes","hasTarget","hasRes","hasBody","created","hasTarget","hasBody","created","hasBody","hasTarget","hasRes","hasRes"],"colour":["#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["object","object","object","object","object","creator","annotation","annotation","object","object","creator","object","object"],"group":["object","object","object","object","object","creator","annotation","annotation","object","object","creator","object","object"],"nodesize":["12","12","12","12","12","12","12","12","12","12","12","12","12"]},"options":{"NodeID":"type","Group":"type","colourScale":"d3.scaleOrdinal(d3.schemeCategory10);","fontSize":7,"fontFamily":"serif","clickTextSize":17.5,"linkDistance":50,"linkWidth":"function(d) { return Math.sqrt(d.value); }","charge":-30,"opacity":1,"zoom":false,"legend":false,"arrows":false,"nodesize":true,"radiusCalculation":" Math.sqrt(d.nodesize)+6","bounded":false,"opacityNoHover":0,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="data-resource-modification" class="section level4">
<h4>Data resource modification</h4>
<p>Neotoma contains a large number of paleoecological records obtained from lake sediment. The lakes are identified by name and location is reported using latitude and longitude coordinates. Data publication for records in Neotoma spans nearly 60 years (<strong>check</strong>), and, as such, the earliest reported locations often had low precision, either rounding when locations were reported as DMS, or as a result of uncertainty when reporting location based on the use of topographic maps.</p>
<p>A recent project by Neotoma resulted in the conversion of locations within the database. Some lake sites had coordinates changed, some sites were unchanged, but additional informaton was added to the resources (for example, original publications were checked and it was not possible to correct the location).</p>
</div>
<div id="an-individual-scripts-a-tool-to-link-resources" class="section level4">
<h4>An individual scripts a tool to link resources</h4>
<p>In this case a user has written a script to link a data resource, and the R package written for that resource, to resources in GitHub. The intention here is to survey ways in which the data resource is being used in analytic workflows.</p>
<pre><code>ropensci_registry &lt;- fromJSON(&quot;https://raw.githubusercontent.com/ropensci/roregistry/master/registry.json&quot;)

packages &lt;- ropensci_registry$packages$name

search_strings &lt;- list(neotoma = list(doi = &#39;10.17616/R3PD38&#39;,
                                      search = &#39;library(neotoma)+in:file+language:R&#39;),
                       dryad = list(doi = &#39;10.17616/R34S33&#39;,
                                    search = &#39;library(rdryad)+in:file+language:R&#39;))

gh_token &lt;- scan(&#39;gh.token&#39;, what = &#39;character&#39;)

test_pks &lt;- list()

for (i in i:length(packages)) { 
  
  # I had to serialize this to avoid getting caught by GitHub&#39;s abuse detection.
  
  x &lt;- packages[i]
  
  Sys.sleep(5) # This is probably longer than it needs to be. . . 
  
  repos &lt;- gh(paste0(&#39;/search/code?q=library(&#39;,x,&#39;)+in:file+language:R+extension:R+extension:Rmd&#39;), 
                   .token = gh_token)
       
  test_pks[[i]] &lt;- list(target = lapply(unique(sapply(repos$items, function(x)x$repository$html_url)), 
                                        function(y) { list(body = y, type = &#39;URL&#39;)}),
                        body = list(body = lapply(paste0(&#39;http://github.com/ropensci/&#39;,x), 
                                                  function(y) { list(type = &#39;URL&#39;, body = y) })),
                                    body = list(type = &quot;TextAnnotation&quot;,
                                                body = paste0(&quot;The GitHub repository uses the package &quot;,
                                                              x,&quot; in a `library()` call.&quot;)),
                        creator = list(URL = &#39;0000-0002-2700-4605&#39;,
                                       PropertyID = &#39;orcid&#39;,
                                       lastName = &#39;Goring&#39;,
                                       firstName = &#39;Simon&#39;),
                        body_rel = list(type = &#39;URL&#39;,
                                        URL = &#39;https://ropensci.org/&#39;))
  cat(i, &#39;\n&#39;)
}

for(i in 1:length(test_pks)) {
  link_record(con = con,
              creator = test_pks[[i]]$creator,
              body = test_pks[[i]]$body,
              target = test_pks[[i]]$target,
              body_rel = test_pks[[i]]$body_rel)
}

results &lt;- cypher(con, &#39;MATCH (bod:body)&lt;-[:hasBody]-(:annotation)-[:hasTarget]-&gt;(n:target)&lt;-[:hasTarget]-(:annotation)-[:hasBody]-&gt;(bod1:body) WHERE bod&lt;&gt;bod1 RETURN DISTINCT bod.body AS package, COLLECT(DISTINCT n.body) AS repos;&#39;)
</code></pre>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
